<!--a site which contains the list of follower in one circle. you are able to add or remove a follower to/from the circle-->
<!--messages from this circle will be shown-->
{% extends "base.html" %}

{% block title %}Kreisdetails{% endblock %}

{% block content %}

    {% include "includes/navbar.html" %}

    <div class="container">

        <div class="thumbnail col-md-5">
            <h3>{{ circle.name }}</h3>
            <!-- add user to this circle -->
            <form class="" method="post" action="{% url "add_users_to_circle" circle.pk %}">
                {% csrf_token %}
                <select multiple="multiple" name="add_members" class="form-control testselect2">
                    {% for follower in followers %}
                        <option value="{{ follower.user.pk }}">{{ follower.user.username }}</option>
                    {% endfor %}
                </select>

                <p>
                    <input type="submit" value="Speichern" class="btn btn-default">
                </p>
            </form>
            <table class="table table-bordered">
                <tr>
                    <th>Members<h6></h6></th>
                    <th>Actions</th>
                </tr>
                {% for user in circle.members.all %}
                    <tr>
                        <!--the name links to the user's profile-->
                        <td>
                            <a href="{% url "view_profile" user.pk %}">{{ user.username }}</a>
                        </td>
                        <td>
                            <!-- remove user from this circle -->
                            <form action="{% url "remove_user_from_circle" user.pk circle.pk %}">
                                <div class="btn-group">
                                    <button class="btn btn-info" type="button">
                                        <span class="glyphicon glyphicon-envelope"></span>
                                    </button>
                                    <button class="btn btn-danger" type="submit">Entfernen</button>
                                </div>
                            </form>
                        </td>
                    </tr>
                {% endfor %}
            </table>
        </div>
        <div class="well col-md-7">
            <div class="row">
                <div class="col-md-12">
                    <h3>Kreisnachrichten</h3>
                    <!-- nachricht nur in diesen kreis schreiben -->
                    <form role="form" method="post" action="{% url "new_circlemessage" %}">
                        {% csrf_token %}
                        <input type="hidden" name="circles" value="{{ circle.pk }}">
                        <div class="input-group">
                            <!-- inputfield for the messages you are going to send -->
                            <input required type="text" name="text" id="text" class="form-control"
                                   placeholder="Kreisnachricht...">

                            <div class="input-group-btn">
                                <button class="btn btn-info" type="submit">Senden</button>
                            </div>

                        </div>
                    </form>
                    <!-- space for circle messages from this circle -->
                    {% for circlemessage in circle.messages.all %}
                        <div class="media">
                        <div class="media-left">
                            <a href="#">
                                <img height="64" width="64" class="media-object"
                                     src="{{ circlemessage.creator.profile.profile_picture }}" alt="Profilbild">
                            </a>
                        </div>
                        <div class="media-body">
                            <h4 class="media-heading">{{ circlemessage.creator }} schrieb
                                am {{ circlemessage.created | date:'d.m.Y H:i' }}:</h4>
                            {{ circlemessage.text }}

                            <div align="right">	
								 <a class="btn btn-info btn-xs" href="#antworten" data-toggle="collapse"><span class="glyphicon glyphicon-share-alt"></span> Antworten</a>
								 <a class="btn btn-info btn-xs" href="#"><span class="glyphicon glyphicon-retweet"></span> Retweet</a>
								 <!-- if you are the creator of the message, a delete button will be shown -->
                                {% if circlemessage.creator == user %}
                                        <a class="btn btn-danger btn-xs" href="{% url "delete_circlemessage" circlemessage.id %}"><span class="glyphicon glyphicon-remove"></span> LÃ¶schen</a>
                                {% endif %}
								<hr>
							</div>
							
						<!-- the answers-->
						{% for answer_to in answer_list  %}	
						<div class="media">
                            <div class="media-left">
                                <a href="#">
                                    <img height="64" width="64" class="media-object"
                                         src="{{ answer_to.circlemessage.creator.profile.profile_picture }}" alt="Profilbild">
                                </a>
                            </div>
                            <div class="media-body">
							<!-- the creator of the answer as well as the date will be shown -->
                                <h4 class="media-heading"><a href="{% url "view_profile" answer_to.circlemessage.creator.pk %}">{{ answer_to.circlemessage.creator }}</a> antwortete
                                    am {{ answer_to.circlemessage.created | date:'d.m.Y H:i' }}:</h4>
                                {{ answer_to.circlemessage.text }}

                            </div>
						
						
						</div>
						
						{% endfor %}
						
                        </div>
						</div>
                    {% endfor %}
					
					<!-- erscheint, wenn auf antworten geklickt wird -->
					<div id="antworten" class="collapse">
						<div class="input-group">
							<input type="text" class="form-control" placeholder="antworte hier...">
							<span class="input-group-btn">
							<button class="btn btn-info" type="submit">Senden</button>
							</span>
						</div>
					</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}